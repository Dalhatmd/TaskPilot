# TaskPilot Authentication Setup Guide

This guide explains how to set up Supabase authentication for TaskPilot.

## Prerequisites

1. **Supabase Account**: Create an account at [supabase.com](https://supabase.com)
2. **Python Environment**: Python 3.8+ with pip

## Setup Steps

### 1. Create Supabase Project

1. Go to [supabase.com](https://supabase.com) and create a new project
2. Note down your project URL and anon key from the project settings
3. Get your database password from the database settings

### 2. Environment Variables

Create a `.env` file in the backend directory with the following variables:

```env
# Security
SECRET_KEY=your-secret-key-here

# Supabase Configuration
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-supabase-anon-key
SUPABASE_DB_PASSWORD=your-database-password

# AI Integration (optional)
GOOGLE_GEMINI_API_KEY=your-gemini-api-key

# Environment
ENVIRONMENT=development
DEBUG=true
```

### 3. Install Dependencies

```bash
cd backend
pip install -r requirements.txt
```

### 4. Database Migration

The User model has been updated to work with Supabase auth. You'll need to create and run a migration:

```bash
# Create migration
alembic revision --autogenerate -m "Update user model for Supabase auth"

# Apply migration
alembic upgrade head
```

### 5. Run the Application

```bash
# Start the FastAPI server
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## API Endpoints

### Authentication Endpoints

- `POST /api/v1/auth/signup` - Register a new user
- `POST /api/v1/auth/login` - Login user
- `GET /api/v1/auth/me` - Get current user profile
- `PUT /api/v1/auth/me` - Update current user profile

### Example Usage

#### Signup
```bash
curl -X POST "http://localhost:8000/api/v1/auth/signup" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123",
    "username": "username",
    "full_name": "Full Name"
  }'
```

#### Login
```bash
curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123"
  }'
```

#### Get Profile (with token)
```bash
curl -X GET "http://localhost:8000/api/v1/auth/me" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

## Testing

Run the test script to verify authentication works:

```bash
python test_auth.py
```

## Architecture

The authentication system uses:

- **Supabase Auth**: Handles user registration, login, and password management
- **JWT Tokens**: For API authentication (generated by our backend)
- **Local Database**: Stores user profile data linked to Supabase user IDs
- **FastAPI Dependencies**: For protecting routes and getting current user

## Security Features

- Password hashing handled by Supabase
- JWT tokens for API authentication
- CORS protection
- Input validation with Pydantic
- SQL injection protection with SQLAlchemy ORM
